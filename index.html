<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chat Interattiva</title>
<link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600&display=swap" rel="stylesheet">
<style>
body {
  font-family: 'Quicksand', sans-serif;
  background: #ece5dd;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  padding-top: 50px;
  height: 100vh;
  margin: 0;
}

/* Icona chat iniziale */
#chatIcon {
  position: relative;
  width: 60px;
  height: 60px;
  background: #25d366;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  font-size: 30px;
  color: white;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}
#chatIcon span {
  position: absolute;
  top: -5px;
  right: -5px;
  background: red;
  color: white;
  font-size: 14px;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: 600;
}

/* Finestra chat */
#chatWindow {
  display: none;
  width: 360px;
  max-height: 550px;
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 8px 15px rgba(0,0,0,0.25);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

#messages {
  flex: 1;
  padding: 12px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.message-container {
  display: flex;
  flex-direction: column;
  max-width: 80%;
}

.name {
  font-size: 13px;
  font-weight: 600;
  margin-bottom: 3px;
}

.message {
  padding: 10px 14px;
  border-radius: 18px;
  line-height: 1.4;
  font-size: 15px;
  word-wrap: break-word;
}

.eli {
  background: #e2f7cb;
  align-self: flex-start;
}

.giglio {
  background: #dcf8c6;
  align-self: flex-start;
}

.user {
  background: #34b7f1;
  color: white;
  align-self: flex-end;
}

.notification {
  text-align: center;
  color: gray;
  font-size: 13px;
  margin: 12px 0;
  font-style: italic;
}

.typing {
  font-size: 12px;
  color: gray;
  margin-left: 5px;
}

/* Barra input */
#inputBar {
  display: none;
  padding: 12px;
  border-top: 1px solid #ddd;
  flex-direction: column;
  gap: 8px;
  cursor: pointer;
  background: #f0f0f0;
}

.options {
  display: none;
  flex-direction: column;
  gap: 6px;
}

.option {
  background: #25d366;
  color: white;
  padding: 10px;
  border-radius: 12px;
  text-align: center;
  cursor: pointer;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0,0,0,0.15);
}

/* Schermata finale */
#finalScreen {
  display: none;
  font-size: 32px;
  color: #25d366;
  text-align: center;
  font-weight: 700;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

/* Animazione pop */
.popIn {
  opacity: 0;
  transform: scale(0.8);
  animation: popIn 0.3s forwards;
}

@keyframes popIn {
  from {opacity: 0; transform: scale(0.8);}
  to {opacity: 1; transform: scale(1);}
}
</style>
</head>
<body>

<!-- Icona chat -->
<div id="chatIcon">üí¨<span>2</span></div>

<!-- Finestra chat -->
<div id="chatWindow">
  <div id="messages"></div>
  <div id="inputBar">
    <span>Scrivi un messaggio...</span>
    <div class="options">
      <div class="option" data-choice="1">Il tuo ovviamente!</div>
      <div class="option" data-choice="2">Quello dell'Umana aveva un tocco di classe.</div>
    </div>
  </div>
</div>

<div id="finalScreen">Anche se abbiamo idee diverse, una cosa vorremmo dirtela insieme: BUON COMPLEANNO! üéâ</div>

<script>
const chatIcon = document.getElementById('chatIcon');
const chatWindow = document.getElementById('chatWindow');
const messages = document.getElementById('messages');
const inputBar = document.getElementById('inputBar');
const options = document.querySelector('.options');
const finalScreen = document.getElementById('finalScreen');

const initialMessages = [
  {sender: 'eli', name: 'Eli üòã', text: 'Ciao Giglio, scusami, ma cosa sarebbe questa storia del regalo?'},
  {sender: 'giglio', name: 'Giglio üêà‚Äç‚¨õ', text: 'Ciao Umana! Beh diciamo che tu non ti sei sprecata molto con il tuo presunto regalo...'},
  {sender: 'eli', name: 'Eli üòã', text: 'La mia idea √® molto carina invece üòí'},
  {sender: 'giglio', name: 'Giglio üêà‚Äç‚¨õ', text: 'Questo lo pensi solo tu... Anzi lasciamo che sia l\'Umano a scegliere üòå'}
];

const liveMessages = [
  {type: 'notification', text: 'Giglio üêà‚Äç‚¨õ ti ha aggiunto alla chat'},
  {type: 'typing', sender: 'giglio', text: 'Ciao Umano! Avrai sicuramente aperto il mio bellissimo regalo! E quello dell\'Umana (sempre che si possa definire regalo...)'},
  {type: 'typing', sender: 'eli', text: 'Giglio... üòí'},
  {type: 'typing', sender: 'giglio', text: 'Dicevo... Quale ti √® piaciuto di pi√π? Il mio BELLISSIMO regalo üéâ, o quella sottospecie di presunto regalo dell\'Umanaüòê?'}
];

chatIcon.addEventListener('click', () => {
  chatIcon.style.display = 'none';
  chatWindow.style.display = 'flex';
  showInitialMessages();
  setTimeout(() => showLiveMessage(0), 6000);
});

function showInitialMessages() {
  initialMessages.forEach(msg => {
    addMessage(msg.sender, msg.name, msg.text);
  });
}

function addMessage(sender, name, text) {
  const container = document.createElement('div');
  container.className = 'message-container popIn';
  const nameDiv = document.createElement('div');
  nameDiv.className = 'name';
  nameDiv.innerText = name;
  const msgDiv = document.createElement('div');
  msgDiv.className = 'message ' + sender;
  msgDiv.innerText = text;
  container.appendChild(nameDiv);
  container.appendChild(msgDiv);
  messages.appendChild(container);
  messages.scrollTop = messages.scrollHeight;
}

function showLiveMessage(i) {
  if(i >= liveMessages.length) {
    inputBar.style.display = 'flex';
    return;
  }

  const msg = liveMessages[i];

  if(msg.type === 'notification') {
    const div = document.createElement('div');
    div.className = 'notification popIn';
    div.innerText = msg.text;
    messages.appendChild(div);
    messages.scrollTop = messages.scrollHeight;
    setTimeout(() => showLiveMessage(i+1), 800);
  } else if(msg.type === 'typing') {
    const name = msg.sender === 'giglio' ? 'Giglio üêà‚Äç‚¨õ' : 'Eli üòã';
    const senderClass = msg.sender === 'giglio' ? 'giglio' : 'eli';
    const container = document.createElement('div');
    container.className = 'message-container popIn';
    const nameDiv = document.createElement('div');
    nameDiv.className = 'name';
    nameDiv.innerText = name;
    const msgDiv = document.createElement('div');
    msgDiv.className = 'message ' + senderClass;
    msgDiv.innerHTML = '<span class="typing">...</span>';
    container.appendChild(nameDiv);
    container.appendChild(msgDiv);
    messages.appendChild(container);
    messages.scrollTop = messages.scrollHeight;

    setTimeout(() => {
      msgDiv.innerHTML = msg.text;
      showLiveMessage(i+1);
    }, 1500);
  }
}

inputBar.addEventListener('click', () => {
  options.style.display = 'flex';
});

document.querySelectorAll('.option').forEach(opt => {
  opt.addEventListener('click', () => {
    const choice = opt.getAttribute('data-choice');
    inputBar.style.display = 'none';

    // Messaggio utente
    addMessage('user', '', opt.innerText);

    setTimeout(() => {
      // Risposta Giglio
      const giglioReply = choice === '1' ? 'Miao!! Lo sapevo üòº' : 'Non ci crede nessuno! Allora rispediscimi il mio regalo üòæ';
      addMessage('giglio', 'Giglio üêà‚Äç‚¨õ', giglioReply);

      // Finale automatico dopo 2 secondi
      setTimeout(() => {
        chatWindow.style.display = 'none';
        finalScreen.style.display = 'block';
      }, 2000);
    }, 1200);
  });
});
</script>

</body>
</html>